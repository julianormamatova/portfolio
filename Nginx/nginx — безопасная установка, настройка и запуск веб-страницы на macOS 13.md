# Введение

Данная инструкция описывает безопасную установку и настройку веб-сервера **nginx** с помощью менеджера пакетов **Homebrew** и запуска на нем веб-страницы на системе **macOS 13.3** (Ventura) для локального тестирования. Инструкция предназначена для всех начинающих пользователей, которые изучают веб-технологии и хотят ознакомиться с **nginx**. 

**nginx** (engine x) — высокопроизводительный веб-сервер с открытым исходным кодом, который часто используется для обслуживания статических веб-страниц.

Выполняет функции:
- **Статического запроса** (HTML, CSS, Java Script) — управляет входящими запросами от клиентов и показывает нужные страницы.
- **Обратного прокси-сервера** — соединяет клиентов с внутренними сервисами, что делает работу клиентов безопасной.  
- **Балансировщика нагрузки** — распределяет входящий трафик между несколькими серверами.
- **SSL-шифрования** — сохраняет безопасность передаваемых данных.  
- **Кеширующего сервера** — многоуровневое кеширование статического и динамического контента.

# Ограничение ответственности (disclaimer)

Автор не несет ответственность за возможные неисправности системы, потерю данных и некорректную работу сервиса. Рекомендуется создать резервную копию перед началом работы. Не рекомендуется использовать в production-среде без консультации системного администратора.

# Предварительные требования

Перед началом работы рекомендуется ознакомиться с документацией **nginx**:
- [Официальная документация](https://nginx.org/en/docs/)
- [Руководство для начинающих](https://nginx.org/ru/docs/beginners_guide.html)
- [Руководство администратора](https://docs.nginx.com/nginx/admin-guide/)

С официальной документацией:
- [Homebrew](https://docs.brew.sh/)

# Термины и определения

*Таблица 1. Термины и определения*

| Термин                            | Определение                                                                                                                            |
| --------------------------------- | -------------------------------------------------------------------------------------------------------------------------------------- |
| nginx                             | HTTP-сервер и обратный прокси-сервер                                                                                                   |
| Homebrew                          | Менеджер пакетов для macOS                                                                                                             |
| Docroot                           | Корневая директория веб-контента                                                                                                       |
| Память RAM (Random Access Memory) | Временная память компьютера (оперативная память), которая используется для хранения данных во время работы процессора                  |
| Память SSD (Solid State Drive)    | Хранилище данных (аналогично жесткому диску), которое используется для хранения операционной системы, программ, файлов и других данных |

# 1. Системные требования
## 1.1. Аппаратные требования

*Таблица 2. Аппаратные требования*

| Компонент        | Минимальные требования            | Рекомендуемые требования |
| ---------------- | --------------------------------- | ------------------------ |
| **Процессор**    | Apple M1                          | Apple M1/M2              |
| **Память (RAM)** | 4 ГБ                              | 8 ГБ                     |
| **Память (SSD)** | 500 МБ свободного места           | 1 ГБ свободного места    |
| **Сеть**         | Интернет для загрузки компонентов | Стабильное подключение   |

## 1.2. Программные требования

*Таблица 3. Программные требования*

| Компонент    | Версия                   |
| ------------ | ------------------------ |
| **macOS**    | 13.3 (Ventura) или новее |
| **Homebrew** | 4.5.8 или новее          |
| **VS Code**  | 1.101.2 или новее        |

# 2. Подготовка системы
## 2.1. Установка Homebrew (если не предустановлен)

**Homebrew** — утилита командной строки для установки пакетов и приложений. 

1. Открыть **Терминал**: нажать **Command** + **Пробел** и найти **Терминал** через поисковую строку:
![[Рисунок 1.png]]
*Рисунок 1. Открытие Терминала*

2. Скопировать команду установки **Homebrew** c официального сайта [brew.sh](https://brew.sh/ru/):
```
/bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
```
![[Рисунок 2.png]]
*Рисунок 2. Скопированный скрипт установки Homebrew с официального сайта*

3. Вставить скопированный скрипт в **Терминал**:
![[Рисунок 3.png]]
*Рисунок 3. Вставленный скрипт в Терминал*

4. Ввести пароль администратора для подтверждения (ввод пароля *не* отображается).
**Важно**: Во время установки **Homebrew** запрашивается пароль (sudo), так как требуются права администратора (root) для установки в системные директории. Вводить пароль администратора следует только при уверенности в источнике скрипта.
![[Рисунок 4.png]]
*Рисунок 4. Введенный пароль администратора*

5. Нажать **Return** и дождаться завершения установки (может занять несколько минут). Появится строка **Installation successful**!
![[Рисунок 5.png]]
*Рисунок 5. Успешно установленный пакетный менеджер Homebrew*

6. Убедиться в корректности установки через команду проверки версии:
```
brew --version
```
![[Рисунок 6.png]]
*Рисунок 6. Проверка версии Homebrew*

## 2.2. Установка VS Code (если не предустановлен)

**VS Code (Visual Studio Code)** — текстовый редактор для дальнейшего редактирования конфигурационных файлов **nginx** и создания html-файлов.

Ниже описаны шаги по установке **VS Code** с помощью **Homebrew** через **Терминал**:

1. Установить **VS Code** командой:
```
brew install --cask visual-studio-code
```

2. Дождаться завершения. **Homebrew** автоматически установит все зависимости.
   Появится строка **visual-studio-code was successfully installed!**
![[Рисунок 7.png]]
*Рисунок 7. Установка VS Code (версия 1.101.2)*

# 3. Установка nginx

Ниже описаны шаги по установке **nginx** с помощью **Homebrew** через **Терминал**:

1. Установить **nginx** командой:
```
brew install nginx
```
![[Рисунок 8.png]]
*Рисунок 8. Установка nginx (версия 1.27.5)*

2. Дождаться завершения. **Homebrew** автоматически установит все зависимости.

3. Запустить сервер:
```
brew services start nginx
```
![[Рисунок 9.png]]
*Рисунок 9. Запуск nginx*

5. Проверить статус (должно быть `started`):
```
brew services list
```
![[Рисунок 10.png]]
*Рисунок 10. Успешный запуск сервера nginx*

6. Проверить работоспособность: открыть браузер и перейти по адресу — http://localhost:8080/. Появится страница с заголовком **Welcome to nginx!**
![[Рисунок 11.png]]
*Рисунок 11. Проверка работоспособности nginx*

**Примечание**: Порт `8080` используется по умолчанию для избежания конфликтов с другими сервисами.

# 4. Управление системой
## 4.1. Полезные команды
### 4.1.1. Homebrew

Ниже представлены команды **Homebrew** для управления пакетами:

Таблица 4. Управление пакетами Homebrew 

| Команда                         | Описание                                      |
| ------------------------------- | --------------------------------------------- |
| `brew update`                   | Обновить список пакетов Homebrew              |
| `brew upgrade`                  | Обновить все установленные пакеты             |
| `brew upgrade <пакет>`          | Обновить конкретный пакет (например, `nginx`) |
| `brew install <пакет>`          | Установить пакет (например, `nginx`)          |
| `brew uninstall <пакет>`        | Удалить пакет                                 |
| `brew list`                     | Показать все установленные пакеты             |
| `brew info <пакет>`             | Информация о пакете (версия, пути)            |
| `brew services list`            | Список сервисов, управляемых через Homebrew   |
| `brew services start <пакет>`   | Запустить сервис (например, `nginx`)          |
| `brew services stop <пакет>`    | Остановить сервис                             |
| `brew services restart <пакет>` | Перезапустить сервис                          |
| `brew doctor`                   | Проверить систему на проблемы                 |
| `brew cleanup`                  | Удалить старые версии пакетов                 |
**Примечание**: Эти команды решают повседневные задачи. Рекомендуется ознакомиться с [официальной документацией Homebrew](https://docs.brew.sh/)

### 4.1.2. nginx

Ниже представлены базовые команды nginx:

Таблица 5. Управление сервером

| Команда                     | Описание                                              |
| --------------------------- | ----------------------------------------------------- |
| `sudo nginx`                  | Запуск nginx (если не работает через `brew services`) |
| `sudo nginx -s stop`          | Остановка сервера                                     |
| `sudo nginx -s reload`        | Перезагрузка конфигурации *без* остановки сервера     |
| `sudo nginx -s reopen`        | Переоткрытие лог-файлов                               |
| `brew services start nginx`   | Запуск через Homebrew (фоновый режим)                 |
| `brew services restart nginx` | Перезапуск через Homebrew                             |

Таблица 6. Проверка конфигурации

| Команда       | Описание                                                  |
| ------------- | --------------------------------------------------------- |
| `sudo nginx -t` | Проверить синтаксис конфига (обязательно перед `reload`!) |
| `sudo nginx -T` | Проверить синтаксис + вывести весь конфиг в терминал      |

Таблица 7. Логи и отладка

| Команда                                        | Описание                                    |
| ---------------------------------------------- | ------------------------------------------- |
| `tail -f /opt/homebrew/var/log/nginx/access.log` | Просмотр логов доступа в реальном времени   |
| `tail -f /opt/homebrew/var/log/nginx/error.log`  | Просмотр ошибок в реальном времени          |
| `sudo lsof -i :80`                               | Проверить, какой процесс использует порт 80 |

Таблица 8. Работа с файлами

| Команда                                        | Описание                                   |
| ---------------------------------------------- | ------------------------------------------ |
| `sudo code /opt/homebrew/etc/nginx/nginx.conf` | Открыть конфиг в VS Code                   |
| `sudo cp nginx.conf nginx.conf.backup`         | Создать резервную копию конфига            |
| `sudo diff nginx.conf nginx.conf.backup`       | Сравнить текущий конфиг с резервной копией |

**Примечание**: Эти команды решают повседневные задачи. Для продвинутых сценариев (например, настройка SSL, балансировки нагрузки) см. [официальную документацию nginx](https://nginx.org/en/docs/)

# 5. Настройка nginx
1. Создать папку на рабочем столе (например, mywebsite):
![[Рисунок 12.png]]
*Рисунок 12. Создание папки mywebsite*

2. Проверить текущего пользователя через **Терминал**:
```
whoami
```
![[Рисунок 13.png]]
*Рисунок 13. Проверка имени пользователя*

3. Найти точный путь к конфигурационному файлу **nginx**:
```
brew info nginx
```
**Примечание**: Обычно конфигурационный файл находится по следующему пути: `/opt/homebrew/etc/nginx/nginx.conf`. Но путь может отличаться в зависимости от конфигурации **Homebrew**.
![[Рисунок 14.png]]
*Рисунок 14. Информация об установленном nginx, включая путь к корневой директории (Docroot) и путь к конфигурационному файлу*

4. Открыть конфигурационный файл через **Терминал** с помощью текстового редактора VS Code (снова потребуется пароль администратора):
```
sudo code /opt/homebrew/etc/nginx/nginx.conf
```

5. После ввода пароля откроется файл в **VS Code** для редактирования:
![[Рисунок 15.png]]
*Рисунок 15. Открытие nginx.conf в тектовом редакторе VS Code*

6. Внутри блока `server {`  отредактировать строки:
   - `listen` —  `8080` → `80` (указывает nginx слушать входящие соединения на стандартном порту 80 для HTTP)
   - `root` —  `html` → `/User/username/Desktop/mywebsite` (указывает корневую директорию веб-страницы, где nginx будет искать файлы, такие как index.html)
![[Рисунок 16.png]]
*Рисунок 16. Настройка виртуального хоста*

6. Проверить синтаксис конфигурационного файла **nginx.conf** через **Терминал** (снова потребуется пароль):
```
sudo nginx -t
```
![[Рисунок 17.png]]
*Рисунок 17. Проверка правильного синтаксиса nginx.conf*

# 6. Создание HTML-файла

1. Открыть **VS Code** и нажать **Command** + **N** для создания нового файла:
![[Рисунок 18.png]]
*Рисунок 18. Открытие нового файла в VS Code*

2. Вставить базовый HTML-код в содержимое файла:
```
<!DOCTYPE html>
<html>
<head>
    <meta charset="UTF-8">
    <title>Моя страница</title>
</head>
<body>
    <h1>Привет, мир!</h1>
    <p>Это моя первая веб-страница на Nginx!</p>
</body>
</html>
```
![[Рисунок 19.png]]
*Рисунок 19. Наполнение содержимого файла базовым HTML-кодом*

3. Нажать на **иконку** файла в левой панели проводника:
![[Рисунок 20.png]]
*Рисунок 20. Навигация по файлам в левой панели VS Code*

4. Нажать **Open Folder** для настройки корневой директории файла:
![[Рисунок 21.png]]
*Рисунок 21. Настройка корневой директории HTML-файла*

5. Выбрать **Рабочий стол** и папку **mywebsite**:
![[Рисунок 22.png]]
*Рисунок 22. Указание корневой директории в папке mywebsite*

6. Нажать **Save** для сохранения файла в папке **mywebsite**:
![[Рисунок 23.png]]
*Рисунок 23. Сохранение HTML-файла в папке mywebsite*

7. Сохранить как **index.html** с расширением HTML:
![[Рисунок 24.png]]
*Рисунок 24. Сохранение файла с расширением HTML*

8. В папке **mywebsite** появится файл **index.html** с расширением:
![[Рисунок 25.png]]
*Рисунок 25. Сохраненный HTML-файл в папке mywebsite*

# 8. Просмотр веб-страницы

1. Просмотреть веб-страницу в браузере по адресу — http://localhost
![[Рисунок 26.png]]
*Рисунок 26. Успешный просмотр веб-страницы в браузере*

# 9. Устранение неполадок (Troubleshooting)

## 9.1. Не запускается nginx

**Проблема**: 

- Команда `brew services start nginx` завершается ошибкой
- При переходе на `http://localhost` страница не загружается

**Решение**:

1. Проверить статус **nginx**:
```
brew services list
```

2. Если статус не `started`, выполнить:
```
brew services restart nginx
```

## 9.2. Ошибки в конфигурации

**Проблема**: 

- После `sudo nginx -t` появляются сообщения о синтаксических ошибках.
- **nginx** перестает отвечать после `reload`

**Решение**:

1. Проверить синтаксис командой:
```
sudo nginx -t
```

2. Если ошибка указывает на строку (например, `line 25`), открыть конфиг:
```
sudo code /opt/homebrew/etc/nginx/nginx.conf
```

3. Убедиться, что все `{ }` и `;` на месте.

4. Проверить корректность пути (например, `/Users/username/Desktop/mywebsite`).

5. Восстановить рабочую версию конфига из резервной копии:
```
sudo cp /opt/homebrew/etc/nginx/nginx.conf.backup /opt/homebrew/etc/nginx/nginx.conf
```

## 9.3. Страница отображается некорректно

**Проблема:**

- В браузере отображаются символы вместо текста.

**Решение:**

1. Проверить кодировку HTML-файла:
- Открыть `index.html` в **VS Code**
- В правом нижнем углу кликнуть на кодировку (должно быть: **UTF-8**).
- Если указана другая, то нажать **Save with Encoding** → **UTF-8**.

2. Проверить наличие мета-тега <meta charset="UTF-8"> в <head>:
